# Submitting unifictl to Homebrew

This guide explains how to submit `unifictl` to the official Homebrew repository (`homebrew-core`).

## Prerequisites

1. **GitHub account** - You'll need to fork `homebrew-core`
2. **macOS system** (recommended) - For testing the formula locally
3. **Homebrew installed** - On your macOS system

## Method 1: Using `brew bump-formula-pr` (Recommended)

This is the easiest method as it automates most of the process:

```bash
# Make sure you have the latest Homebrew
brew update

# Use brew bump-formula-pr to create a PR automatically
brew bump-formula-pr \
  --url=https://github.com/nachtschatt3n/unifictl/releases/download/v0.4.5/unifictl-x86_64-apple-darwin.tar.gz \
  --sha256=08eb33076cdb95b21b9fa810a7ee7ac0d310e7bbe63923a3ac5e803972479386 \
  unifictl
```

**Note:** This command will:
- Fork `homebrew-core` (if not already forked)
- Create a new branch
- Create the formula file
- Open a PR automatically

However, you'll need to manually add the ARM64 (Apple Silicon) binary support after the PR is created.

## Method 2: Manual Submission

### Step 1: Fork homebrew-core

1. Go to https://github.com/Homebrew/homebrew-core
2. Click "Fork" to create your fork

### Step 2: Clone your fork

```bash
git clone https://github.com/YOUR_USERNAME/homebrew-core.git
cd homebrew-core
```

### Step 3: Create a new branch

```bash
git checkout -b add-unifictl
```

### Step 4: Create the formula file

Create the file `Formula/u/unifictl.rb` with the following content:

```ruby
# typed: false
# frozen_string_literal: true

# This file was generated by unifictl. DO NOT EDIT.
class Unifictl < Formula
  desc "CLI for UniFi Site Manager (API v1/EA)"
  homepage "https://github.com/nachtschatt3n/unifictl"
  version "0.4.5"
  license "GPL-3.0"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/nachtschatt3n/unifictl/releases/download/v0.4.5/unifictl-x86_64-apple-darwin.tar.gz"
      sha256 "08eb33076cdb95b21b9fa810a7ee7ac0d310e7bbe63923a3ac5e803972479386"
    end
    if Hardware::CPU.arm?
      url "https://github.com/nachtschatt3n/unifictl/releases/download/v0.4.5/unifictl-aarch64-apple-darwin.tar.gz"
      sha256 "9dbab71b9bc110a046057e575e77eaa2fd66cf874a5c5ade2c1d105752e48622"
    end
  end

  def install
    bin.install "unifictl"
  end

  test do
    system "#{bin}/unifictl", "--version"
  end
end
```

### Step 5: Test the formula locally

```bash
# Install from your local formula
brew install --build-from-source Formula/u/unifictl.rb

# Or test without installing
brew test Formula/u/unifictl.rb

# Check for any issues
brew audit --strict Formula/u/unifictl.rb
```

### Step 6: Commit and push

```bash
git add Formula/u/unifictl.rb
git commit -m "Add unifictl formula"
git push origin add-unifictl
```

### Step 7: Create a Pull Request

1. Go to your fork on GitHub
2. Click "New Pull Request"
3. Select your branch (`add-unifictl`)
4. Fill out the PR template with:
   - Description of the package
   - Link to the project
   - Why it's useful
   - Any relevant information

## Homebrew Requirements Checklist

Before submitting, ensure:

- [x] **Formula follows naming convention**: `Formula/u/unifictl.rb` (first letter of package name)
- [x] **Version is stable**: v0.4.5 is a stable release
- [x] **License is open source**: GPL-3.0 ✓
- [x] **Homepage is accessible**: https://github.com/nachtschatt3n/unifictl ✓
- [x] **Binaries are available**: Both Intel and ARM64 macOS binaries ✓
- [x] **SHA256 checksums are correct**: Verified ✓
- [x] **Test block exists**: `--version` test included ✓
- [x] **No hardcoded paths**: Uses `bin.install` ✓
- [x] **No dependencies**: Binary is self-contained ✓

## Common Issues and Solutions

### Issue: Formula audit fails

Run `brew audit --strict Formula/u/unifictl.rb` to check for issues:

- **Missing description**: Ensure `desc` is present and descriptive
- **Missing license**: Ensure `license` is specified
- **SHA256 mismatch**: Re-download and recalculate checksums
- **URL not accessible**: Verify the release URLs are public

### Issue: Test fails

Ensure the test block works:

```bash
brew test Formula/u/unifictl.rb
```

If it fails, check:
- Binary is executable
- Binary responds to `--version`
- No missing dependencies

### Issue: ARM64 support missing

Homebrew requires both Intel and ARM64 binaries for macOS. Both are included in the formula above.

## After Submission

1. **Monitor the PR**: Homebrew maintainers will review and may request changes
2. **Respond to feedback**: Address any comments or requested changes promptly
3. **Wait for merge**: Once merged, the formula will be available via `brew install unifictl`

## Updating the Formula

For future releases, use:

```bash
brew bump-formula-pr --url=<new-url> --sha256=<new-sha256> unifictl
```

Or manually update the version and checksums in the formula file.

## Resources

- [Homebrew Formula Cookbook](https://docs.brew.sh/Formula-Cookbook)
- [Homebrew Acceptable Formulae](https://docs.brew.sh/Acceptable-Formulae)
- [Homebrew Pull Request Template](https://github.com/Homebrew/homebrew-core/blob/master/.github/PULL_REQUEST_TEMPLATE.md)
